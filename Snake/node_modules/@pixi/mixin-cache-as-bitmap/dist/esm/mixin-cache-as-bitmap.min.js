/*!
 * @pixi/mixin-cache-as-bitmap - v6.0.0
 * Compiled Tue, 02 Mar 2021 21:45:03 UTC
 *
 * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{RenderTexture as t,BaseTexture as a,Texture as e}from"@pixi/core";import{Sprite as i}from"@pixi/sprite";import{DisplayObject as r}from"@pixi/display";import{Matrix as s}from"@pixi/math";import{uid as n}from"@pixi/utils";import{settings as h}from"@pixi/settings";var o=new s;r.prototype._cacheAsBitmap=!1,r.prototype._cacheData=null,r.prototype._cacheAsBitmapResolution=null;var c=function(){return function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}();Object.defineProperties(r.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var a;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new c),(a=this._cacheData).originalRender=this.render,a.originalRenderCanvas=this.renderCanvas,a.originalUpdateTransform=this.updateTransform,a.originalCalculateBounds=this.calculateBounds,a.originalGetLocalBounds=this.getLocalBounds,a.originalDestroy=this.destroy,a.originalContainsPoint=this.containsPoint,a.originalMask=this._mask,a.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((a=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=a.originalRender,this.renderCanvas=a.originalRenderCanvas,this.calculateBounds=a.originalCalculateBounds,this.getLocalBounds=a.originalGetLocalBounds,this.destroy=a.originalDestroy,this.updateTransform=a.originalUpdateTransform,this.containsPoint=a.originalContainsPoint,this._mask=a.originalMask,this.filterArea=a.originalFilterArea))}}}),r.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},r.prototype._initCachedDisplayObject=function(r){if(!this._cacheData||!this._cacheData.sprite){var s=this.alpha;this.alpha=1,r.batch.flush();var c=this.getLocalBounds(null,!0).clone();if(this.filters){var l=this.filters[0].padding;c.pad(l)}c.ceil(h.RESOLUTION);var d=r.renderTexture.current,p=r.renderTexture.sourceFrame.clone(),u=r.projection.transform,m=t.create({width:c.width,height:c.height,resolution:this.cacheAsBitmapResolution||r.resolution}),_="cacheAsBitmap_"+n();this._cacheData.textureCacheId=_,a.addToCache(m.baseTexture,_),e.addToCache(m,_);var f=this.transform.localTransform.copyTo(o).invert().translate(-c.x,-c.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:m,clear:!0,transform:f,skipUpdateTransform:!1}),r.projection.transform=u,r.renderTexture.bind(d,p),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var C=new i(m);C.transform.worldTransform=this.transform.worldTransform,C.anchor.x=-c.x/c.width,C.anchor.y=-c.y/c.height,C.alpha=s,C._bounds=this._bounds,this._cacheData.sprite=C,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=C.containsPoint.bind(C)}},r.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},r.prototype._initCachedDisplayObjectCanvas=function(r){if(!this._cacheData||!this._cacheData.sprite){var s=this.getLocalBounds(null,!0),c=this.alpha;this.alpha=1;var l=r.context,d=r._projTransform;s.ceil(h.RESOLUTION);var p=t.create({width:s.width,height:s.height}),u="cacheAsBitmap_"+n();this._cacheData.textureCacheId=u,a.addToCache(p.baseTexture,u),e.addToCache(p,u);var m=o;this.transform.localTransform.copyTo(m),m.invert(),m.tx-=s.x,m.ty-=s.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:p,clear:!0,transform:m,skipUpdateTransform:!1}),r.context=l,r._projTransform=d,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var _=new i(p);_.transform.worldTransform=this.transform.worldTransform,_.anchor.x=-s.x/s.width,_.anchor.y=-s.y/s.height,_.alpha=c,_._bounds=this._bounds,this._cacheData.sprite=_,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=_.containsPoint.bind(_)}},r.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},r.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},r.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,a.removeFromCache(this._cacheData.textureCacheId),e.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},r.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};export{c as CacheData};
//# sourceMappingURL=mixin-cache-as-bitmap.min.js.map
